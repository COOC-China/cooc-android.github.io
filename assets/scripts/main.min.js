const CATEGORY = "CATEGORY";

$(function () {
    var navbarHeight = $("#navbar").height();
    var mainHeight = $("#main").height();
    var footerHeight = $("#footer").height();
    var windowHeight = $(window).height();

    if ((navbarHeight + mainHeight + footerHeight) < windowHeight) {
        var minHeight = windowHeight - navbarHeight - footerHeight - 70;
        $("#main").css({
            minHeight, minHeight
        });
    }
});

$(document).ready(function () {
    $(window).resize(function(){
        var navbarHeight = $("#navbar").height();
        var mainHeight = $("#main").height();
        var footerHeight = $("#footer").height();
        var windowHeight = $(window).height();

        if ((navbarHeight + mainHeight + footerHeight) < windowHeight) {
            var minHeight = windowHeight - navbarHeight - footerHeight - 70;
            $("#main").css({
                minHeight, minHeight
            });
        }
    })

    $(".categoryBtn").click(function () {
        var category = $(this).attr('category');
        setCookie(CATEGORY, category);
        location.href = "/categories.html";
    });

    $("button.expandableBtn").click(function () {
        $(this).parent().next().slideToggle({
            progress: function (animation, progress, remainingMs) {
                if (progress == 0) {
                    var button = $(this).prev().children('button.expandableBtn');
                    if (button.attr('aria-expanded') == 'true') {
                        button.animate({rotate: '180'}, 400);
                        button.attr('aria-expanded', 'false');
                    } else {
                        button.animate({rotate: '0'}, 400);
                        button.attr('aria-expanded', 'true');
                    }
                }
            }
        });
    });

    $("#galleryBtn").click(function(){
        if($("#galleryBtn").attr('aria-expanded') == 'false'){
            var autoHeight = $("#thumbs").get(0).scrollHeight;
            $("#thumbs").animate({
                height:autoHeight
            },400);
            $("#galleryBtn").attr('aria-expanded','true');
            $("#galleryBtn").text('收起');
        }
        else {
            $("#thumbs").animate({
                height:'180px'
            },400);
            $("#galleryBtn").attr('aria-expanded','false');
            $("#galleryBtn").text('查看全部');
        }
    });
});

function setCookie(key, val) {
    document.cookie = key + "=" + escape(val);
}

function getCookie(key) {
    if (document.cookie.length > 0) {
        c_start = document.cookie.indexOf(key + "=");
        if (c_start != -1) {
            c_start = c_start + key.length + 1;
            c_end = document.cookie.indexOf(";", c_start);
            if (c_end == -1) c_end = document.cookie.length;
            return unescape(document.cookie.substring(c_start, c_end));
        }
    }
    return "";
}

function delCookie(key) {
    document.cookie = key + "=;expires=-1";
}
